/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[23],{432:function(ia,ea,e){e.r(ea);var da=e(1),fa=e(13),ha=e(2);ia=e(50);var ca=e(31),ba=e(10);e=function(){function e(){this.init()}e.prototype.init=function(){this.O3=!1;this.lf=this.Lk=this.connection=null;this.ir={};this.fa=this.WD=null};e.prototype.hja=function(e){for(var w=this,r=0;r<e.length;++r){var h=e[r];switch(h.at){case "create":this.ir[h.author]||(this.ir[h.author]=h.aName);this.waa(h);break;case "modify":this.fa.nl(h.xfdf).then(function(e){w.fa.nb(e[0])});
break;case "delete":this.fa.nl("<delete><id>"+h.aId+"</id></delete>")}}};e.prototype.waa=function(e){var w=this;this.fa.nl(e.xfdf).then(function(r){r=r[0];r.authorId=e.author;w.fa.nb(r);w.fa.trigger(fa.a.UPDATE_ANNOTATION_PERMISSION,[r])})};e.prototype.W$=function(e,z,r){this.Lk&&this.Lk(e,z,r)};e.prototype.preloadAnnotations=function(e){this.addEventListener("webViewerServerAnnotationsEnabled",this.W$.bind(this,e,"add",{imported:!1}),{once:!0})};e.prototype.initiateCollaboration=function(w,z,r){var h=
this;if(w){h.lf=z;h.fa=r.ua();r.addEventListener(fa.c.DOCUMENT_UNLOADED,function(){h.disableCollaboration()});h.Hja(w);var n=new XMLHttpRequest;n.addEventListener("load",function(){if(200===n.status&&0<n.responseText.length)try{var f=JSON.parse(n.responseText);h.connection=exports.Wa.jka(Object(ca.j)(h.lf,"blackbox/"),"annot");h.WD=f.id;h.ir[f.id]=f.user_name;h.fa.MK(f.id);h.connection.sL(function(e){e.t&&e.t.startsWith("a_")&&e.data&&h.hja(e.data)},function(){h.connection.send({t:"a_retrieve",dId:w});
h.trigger(e.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[h.ir[f.id],h.WD])},function(){h.disableCollaboration()})}catch(y){Object(ha.g)(y.message)}});n.open("GET",Object(ca.j)(this.lf,"demo/SessionInfo.jsp"));n.withCredentials=!0;n.send();h.O3=!0;h.fa.uW(function(e){return h.ir[e.Author]||e.Author})}else Object(ha.g)("Document ID required for collaboration")};e.prototype.disableCollaboration=function(){this.Lk&&(this.fa.removeEventListener(ba.a.Events.ANNOTATION_CHANGED,this.Lk),this.Lk=null);this.connection&&
this.connection.WG();this.fa&&this.fa.MK("Guest");this.init();this.trigger(e.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};e.prototype.Hja=function(e){var w=this;this.Lk&&this.fa.removeEventListener(ba.a.Events.ANNOTATION_CHANGED,this.Lk);this.Lk=function(r,h,n){return Object(da.b)(this,void 0,void 0,function(){var f,y,x,z,aa,ba,ca,ea,fa;return Object(da.d)(this,function(da){switch(da.label){case 0:if(n.imported)return[2];f={t:"a_"+h,dId:e,annots:[]};return[4,w.fa.aH()];case 1:y=da.ea();"delete"!==
h&&(x=(new DOMParser).parseFromString(y,"text/xml"),z=new XMLSerializer);for(aa=0;aa<r.length;aa++)ba=r[aa],ea=ca=void 0,"add"===h?(ca=x.querySelector('[name="'+ba.Id+'"]'),ea=z.serializeToString(ca),fa=null,ba.InReplyTo&&(fa=w.fa.Sf(ba.InReplyTo).authorId||"default"),f.annots.push({at:"create",aId:ba.Id,author:w.WD,aName:w.ir[w.WD],parent:fa,xfdf:"<add>"+ea+"</add>"})):"modify"===h?(ca=x.querySelector('[name="'+ba.Id+'"]'),ea=z.serializeToString(ca),f.annots.push({at:"modify",aId:ba.Id,xfdf:"<modify>"+
ea+"</modify>"})):"delete"===h&&f.annots.push({at:"delete",aId:ba.Id});0<f.annots.length&&w.connection.send(f);return[2]}})})}.bind(w);this.fa.addEventListener(ba.a.Events.ANNOTATION_CHANGED,this.Lk)};e.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return e}();Object(ia.a)(e);ea["default"]=e}}]);}).call(this || window)
